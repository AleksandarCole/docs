
  * [Overview](#overview)
  * [Quick start](#quick-start)
  * [How to use sem](#how-to-use-sem)
     * [Quick examples](#quick-examples)
  * [The process in more detail](#the-process-in-more-detail)
     * [A YAML file for creating secrets](#a-yaml-file-for-creating-secrets)
     * [How to tie an existing secret into a pipeline quickly](#how-to-tie-an-existing-secret-into-a-pipeline-quickly)
     * [Showing existing secrets](#showing-existing-secrets)
     * [Showing the contents of an existing secret](#showing-the-contents-of-an-existing-secret)
     * [Updating existing secrets](#updating-existing-secrets)
     * [Deleting a secret](#deleting-a-secret)
     * [What if you try to use a secret that does not exist](#what-if-you-try-to-use-a-secret-that-does-not-exist)
  * [Use cases](#use-cases)
     * [How to handle a ssh key](#)
	 * [How to store something into a S3 bucket](#)
	 * [How to store credentials for accessing Docker registry](#)
	 * [Connecting to a Kubernetes cluster](#)
  * [See also](#see-also)

## Overview

This documentation page will demonstrate the use of secrets in Semaphore 2.0
projects.

## Quick start

In this section you will learn how to work with secrets on your Semaphore 2.0
projects with the help of the `sem` command line utility.

In order to follow this page you will need to have the `sem`
utility installed on your machine. You can download `sem` by following
these [instructions]().

## How to use sem

The `sem` commands for working with secrets are the following:

* `sem create -f aFile.yml`: creates a new secret
* `sem get secrets`: for listing existing secrets
* `sem describe secrets <secret bucket>`: for listing the contents of an
    existing secret
* `sem delete secrets <secret bucket>`: for deleting an existing secret

You will see all these commands in action in a while.

### Quick examples

This section will present some everyday `sem` commands that can help you work
with secrets as well as a Semaphore pipeline YAML file that uses an existing
secret.

The following `sem` command create a new secret under the active organization:

    sem create -f add-secrets.yml

The contents of `add-secrets.yml` are as follows:

    apiVersion: v1alpha
    kind: Secret
    metadata:
      name: my-example-secrets
    data:
      env_vars:
        - name: ONE
          value: Secret ONE
        - name: TWO
          value: Secret TWO

An example pipeline YAML file that uses secrets is the following:

    $ cat .semaphore/semaphore.yml
    version: v1.0
    name: Using secrets in Semaphore projects
    agent:
      machine:
        type: e1-standard-2
        os_image: ubuntu1804
		
    blocks:
      - task:
          jobs:
            - name: My secrets
              commands:
                - echo $ONE
                - echo $TWO
          secrets:
            - name: my-example-secrets

So, what is happening here? The `secrets` property allows you to define a list
of existing secrets that you want to import. In this case the name of the
secret is `my-example-secrets` â€“ all the contents of `my-example-secrets`
will be imported.

Please notice that if the names of the environment variables of two or more
`secrets` are the same, then the environment variable will have the value that
can be found in the secret that was imported last.

The following command prints the secret names of the active organization:

    sem get secrets

The following command prints the contents of the `my-example-secrets` secret:

    sem describe secrets my-example-secrets

Last, the following example deletes `my-example-secrets`:

    sem delete secrets my-example-secrets

## The process in more detail

The process of creating and using a secret involves the following steps:

* Creating a secrets YAML file
* Importing that secrets YAML file to Semaphore using `sem`
* Using the secret you have just created in a Semaphore project

### A YAML file for creating secrets

Everything that is related with secrets starts from a YAML file that is
specific to secrets and allows you to create new secrets under the current
organization. For the purposes of this documentation page, the YAML file that
is going to be used is named `createSecret.yml` and has the following content:

    $ cat createSecret.yml
    apiVersion: v1alpha
    kind: Secret
    metadata:
      name: my-secrets
    data:
      env_vars:
        - name: SECRET_ONE
          value: "Ca c'est un petite secret"
        - name: SECRET_TWO
          value: "Secret deux"

Each secrets YAML file creates a new `secrets` bucket, which is a place for
storing secrets, that can contain one or more secrets. You recall a `secrets`
bucket on your Semaphore project by its name.

Have in mind that each `secrets` bucket is stored under a Semaphore
organization and that in order to use a particular `secrets` bucket you should
be connected to its related organization.

You can now import that secret YAML file into Semaphore by executing the
following command:

    sem create -f createSecret.yml

### How to tie an existing secret into a pipeline quickly

Imagine that you have the following `.semaphore/semaphore.yml` file:

    $ cat .semaphore/semaphore.yml
    version: v1.0
    name: Using secrets in Semaphore
    agent:
      machine:
        type: e1-standard-2
        os_image: ubuntu1804
	
    blocks:
      - task:
          jobs:
            - name: Using Secrets
              commands:
			    - checkout

If you know that name of one or more secrets, which for the purposes of this
page will be `my-secrets` and `more-secrets`, you can quickly add them to a
Semaphore project by including the following lines into its pipeline YAML file:

          secrets:
            - name: my-secrets
            - name: more-secrets

After that, the original `.semaphore/semaphore.yml` file will look as follows:

    $ cat .semaphore/semaphore.yml
    version: v1.0
    name: Using secrets in Semaphore
    agent:
      machine:
        type: e1-standard-2
        os_image: ubuntu1804
	
    blocks:
      - task:
          jobs:
            - name: Using Secrets
              commands:
			    - checkout
                - echo $TWO
                - echo $ONE
				- echo $SECRET_ONE
          secrets:
            - name: my-secrets
            - name: more-secrets

### Showing existing secrets

Getting a list of the secrets that exist under the active organization requires
the execution of the next command:

    sem get secrets

### Showing the contents of an existing secret

You can see the contents of an existing secret as follows:

    sem describe secrets my-secrets

The following command can help you get the contents of all the secrets of the
current organization:

    sem get secrets | grep -v NAME | xargs -n1 sem describe secrets

### Updating existing secrets

Updating existing secrets can be also done with the `sem` utility. Imagine that
you have `createSecret.yml` that was defined earlier in this page and you want
to update the value of `SECRET_ONE` into `This is a little secret`.


### Deleting a secret

Deleting an existing secret along with its contents is as simple as executing
the following command:

    sem delete secrets my-secrets

The only way to recreate a secret that you deleted is to find the secret YAML
file of that secret and execute `sem create`.

### What if you try to use a secret that does not exist

In that case the pipeline will fail to execute.

## Use cases

This section will present some real world scenarios that use Semaphore 2.0 and
utilize secrets.

### How to handle a ssh key (connect to remote server)

In this section you will learn how to store and retrieve ssh keys as secrets
in order to connect to a remote SSH server without needing a password or
exchange files securely using SFTP without the need to login.


### How to store something into S3 bucket -  AWS key&secret  <= env vars

In this section you will learn how to store files or data to a S3 bucket. In
order to do that you will need the following:

* AWS key
* AWK secret

After that you will need to save this data into a secrets YAML file in order
to insert it into Semaphore 2.0. The secrets YAML file that will be used is as
follows:


### Store credentials for accessing docker registry (AWS - env vars, Google - file <= we need file support first)

This section will illustrate how to use credentials for accessing Docker
registry. In order to do that you will need the following data:

* First:
* Second:

After that you will need to save the data into a secrets YAML file, which is
going to be the following:



### Connecting to k8s cluster (Google - file <= we need file support first)

The scenario that is going to be illustrated in this section has to do with
saving files to a Kubernetes cluster. In order to do that you will need to have
the following information at hand:

* First:
* Second:

Then you will need to insert that data into Semaphore 2.0 as secrets. For the
purposes of this documentation page the following secrets YAML file will be
used:


## See also

* [Download sem]()
* [Secrets YAML reference](https://docs.semaphoreci.com/article/51-secrets-yaml-reference)
* [sem command line tool reference](https://docs.semaphoreci.com/article/53-sem-reference)
* [Projects YAML reference](https://docs.semaphoreci.com/article/52-projects-yaml-reference)
* [Pipeline YAML Reference](https://docs.semaphoreci.com/article/50-pipeline-yaml)
* [Changing Organizations](https://docs.semaphoreci.com/article/29-changing-organizations)
